erDiagram
    %% Users: clients, barbers, admins
    User {
        int id PK
        string name
        string email "unique"
        string role "CLIENT | BARBER | ADMIN"
        string phone_number
        string google_id
        datetime created_at
        bool active
    }

    %% Services offered by the barbershop
    Service {
        int id PK
        string name
        int duration_minutes
        decimal price
        text description
        bool active
    }

    %% Appointments (bookings)
    Appointment {
        int id PK
        datetime appointment_datetime
        int duration_minutes
        string status "BOOKED | COMPLETED | CANCELED"
        text notes
        datetime created_at
        bool active
    }

    %% Barber weekly schedule (availability)
    BarberSchedule {
        int id PK
        int barber_id FK
        int day_of_week
        time start_time
        time end_time
        bool active
    }

    %% Ratings and reviews for completed appointments
    Rating {
        int id PK
        int appointment_id FK
        int user_id FK
        int score
        text comment
        datetime created_at
    }

    %% Payments / transactions for appointments (optional)
    Payment {
        int id PK
        int appointment_id FK
        decimal amount
        string currency
        string status "PENDING | COMPLETED | REFUNDED"
        datetime paid_at
        string provider
    }

    %% Optional: External calendar event mapping
    CalendarEvent {
        int id PK
        int appointment_id FK
        string external_event_id
        string provider "google_calendar"
        datetime synced_at
    }

    %% Relationships
    %% User (client) books many Appointments
    User ||--o{ Appointment : "books"

    %% A barber (User with role=BARBER) can be assigned to many Appointments
    User ||--o{ BarberSchedule : "has schedule"
    User ||--o{ Appointment : "assigned to"

    %% Service included in many Appointments (one Appointment has one Service)
    Service ||--o{ Appointment : "included in"

    %% Appointment may reference a BarberSchedule (optional)
    Appointment }o--|| BarberSchedule : "fits into"

    %% Ratings belong to an Appointment and to a User
    Appointment ||--o{ Rating : "has"
    User ||--o{ Rating : "writes"

    %% Payments are linked to Appointments
    Appointment ||--o{ Payment : "billed by"

    %% CalendarEvent ties an Appointment to an external calendar
    Appointment ||--o{ CalendarEvent : "syncs to"

    
    %% Notes:
    %% - Users table stores both clients and barbers; barber-specific fields can be added in a profile table if needed.
    %% - BarberSchedule uses day_of_week (0-6) and start/end times to define availability.